<!DOCTYPE html>
<html>
<head>
  <title>Delete Account</title>
</head>
<body>
  <h1>Delete Your Account</h1>

  <div id="loginDiv">
    <input type="email" id="email" placeholder="Email"><br><br>
    <input type="password" id="password" placeholder="Password"><br><br>
    <button onclick="login()">Login</button>
  </div>

  <div id="deleteDiv" style="display:none">
    <p>Logged in as <span id="userEmail"></span></p>
    <button onclick="deleteAccount()">Delete Account Permanently</button>
  </div>

  <script type="module">
  // Import the functions you need from the SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-functions.js";

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCGIRnV7GskIXXWg8UnrwMOoMdD_BQo7Sc",
  authDomain: "kochapp-2b000.firebaseapp.com",
  projectId: "kochapp-2b000",
  storageBucket: "kochapp-2b000.firebasestorage.app",
  messagingSenderId: "197619772835",
  appId: "1:197619772835:web:9f155db7c7a0f488423e16",
  measurementId: "G-YMR8NJVYVK"
};

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const functions = getFunctions(app);

  // Attach functions to the window object so the HTML buttons can find them
  window.login = async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      document.getElementById("loginDiv").style.display = "none";
      document.getElementById("deleteDiv").style.display = "block";
      document.getElementById("userEmail").innerText = userCredential.user.email;
    } catch (err) {
      alert("Login failed: " + err.message);
    }
  };

  window.deleteAccount = async () => {
    const deleteFn = httpsCallable(functions, "deleteAccount");
    try {
      await deleteFn();
      alert("Your account has been permanently deleted.");
      await signOut(auth);
      document.getElementById("deleteDiv").style.display = "none";
      document.getElementById("loginDiv").style.display = "block";
    } catch (err) {
      alert("Deletion failed: " + err.message);
    }
  };
</script>
</body>
</html>
